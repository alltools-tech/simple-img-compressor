<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Compressor - JPEG/PNG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; }
    h1 { color: #333; }
    .container { display: flex; gap: 2em; }
    .panel { background: #fff; padding: 1em; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .preview-img { max-width: 300px; max-height: 200px; display: block; margin-bottom: 1em; }
    label { display: block; margin: 1em 0 0.5em; }
    input[type="range"] { width: 100%; }
    .size-info { margin-bottom: 1em; }
    .btn { padding: 0.5em 1em; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    .btn:disabled { background: #aaa; }
  </style>
</head>
<body>
  <h1>JPEG/PNG Compressor</h1>
  <div class="container">
    <!-- Before Compression -->
    <div class="panel" style="flex:1">
      <h2>Original</h2>
      <input type="file" id="fileInput" accept="image/jpeg, image/png">
      <img id="originalPreview" class="preview-img" src="" alt="" style="display:none;">
      <div class="size-info" id="originalSize"></div>
    </div>

    <!-- After Compression -->
    <div class="panel" style="flex:1">
      <h2>Compressed</h2>
      <img id="compressedPreview" class="preview-img" src="" alt="" style="display:none;">
      <div class="size-info" id="compressedSize"></div>
      <button id="downloadBtn" class="btn" disabled>Download Compressed Image</button>
    </div>
  </div>

  <!-- Advanced Options -->
  <div class="panel" style="margin-top:2em;">
    <h2>Advanced Options</h2>
    <label>Quality: <span id="qualityValue">80</span>%</label>
    <input type="range" id="qualityRange" min="10" max="100" value="80">
    <label>Resize Width (px, optional):</label>
    <input type="number" id="resizeWidth" min="1" placeholder="Keep original">
    <label>Resize Height (px, optional):</label>
    <input type="number" id="resizeHeight" min="1" placeholder="Keep original">
    <button id="compressBtn" class="btn" disabled>Compress</button>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const originalPreview = document.getElementById('originalPreview');
    const originalSize = document.getElementById('originalSize');
    const compressedPreview = document.getElementById('compressedPreview');
    const compressedSize = document.getElementById('compressedSize');
    const qualityRange = document.getElementById('qualityRange');
    const qualityValue = document.getElementById('qualityValue');
    const resizeWidth = document.getElementById('resizeWidth');
    const resizeHeight = document.getElementById('resizeHeight');
    const compressBtn = document.getElementById('compressBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    let originalFile = null;
    let compressedBlob = null;

    fileInput.addEventListener('change', function() {
      const file = this.files[0];
      if (file && (file.type === "image/jpeg" || file.type === "image/png")) {
        originalFile = file;
        const reader = new FileReader();
        reader.onload = function(e) {
          originalPreview.src = e.target.result;
          originalPreview.style.display = 'block';
          originalSize.textContent = "Size: " + (file.size / 1024).toFixed(2) + " KB";
          compressBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      } else {
        originalPreview.style.display = 'none';
        originalSize.textContent = "";
        compressBtn.disabled = true;
      }
      compressedPreview.style.display = 'none';
      compressedSize.textContent = '';
      downloadBtn.disabled = true;
    });

    qualityRange.addEventListener('input', function() {
      qualityValue.textContent = this.value;
    });

    compressBtn.addEventListener('click', function() {
      if (!originalFile) return;
      const img = new Image();
      img.onload = function() {
        let canvas = document.createElement('canvas');
        let ctx = canvas.getContext('2d');
        let width = img.width;
        let height = img.height;
        // Resize if needed
        if (resizeWidth.value) width = parseInt(resizeWidth.value);
        if (resizeHeight.value) height = parseInt(resizeHeight.value);
        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);
        // Compress
        let mimeType = originalFile.type;
        let quality = parseInt(qualityRange.value) / 100;
        canvas.toBlob(function(blob) {
          compressedBlob = blob;
          const url = URL.createObjectURL(blob);
          compressedPreview.src = url;
          compressedPreview.style.display = 'block';
          compressedSize.textContent = "Size: " + (blob.size / 1024).toFixed(2) + " KB";
          downloadBtn.disabled = false;
        }, mimeType, quality);
      };
      img.src = URL.createObjectURL(originalFile);
    });

    downloadBtn.addEventListener('click', function() {
      if (!compressedBlob) return;
      const a = document.createElement('a');
      a.href = URL.createObjectURL(compressedBlob);
      a.download = "compressed_" + originalFile.name;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });
  </script>
</body>
</html>